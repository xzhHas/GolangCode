---
title: 为什只有InnoDB支持行级锁？
shortTitle: 4.为什只有InnoDB支持行级锁？
category:
  - MySQL
tag:
  - MySQL
date: 2024-06-11
star: true
---

## 1.MySQL有哪些锁？

- 全局锁
- 表级锁
  - 表锁
  - 元数据锁
  - 意向锁
- 行级锁
  - 记录锁
  - 间隙锁
  - 临键锁
  - 临时意向锁

我了解的是MySQL的锁可以分为全局锁、表级锁、行级锁。

我比较熟悉的是表级锁和行级锁，如果我们对表结构进行修改时，MySQL就会对这个表结构加一个元数据锁。

行级锁目前只有InnoDB存储引擎实现了，主要有记录锁、间隙锁、临键锁、插入意向锁。

## 2.MySQL是怎么加锁的【可重复读隔离级别】？

加锁的对象是索引，加锁的基本单位是临键锁，临键锁是前开后闭区间，间隙锁是前开后开区间。但是在某些场景下，临键锁是会退化成记录锁或间隙锁的，那就是在使用记录锁或间隙锁就能避免幻读的场景下。

推荐文章：[MySQL 是怎么加锁的？](https://xiaolincoding.com/mysql/lock/how_to_lock.html#mysql-是怎么加行级锁的)

### 2.1 对于等值查询那么他会怎么加锁？

首先我们可以想到，查询的这个是唯一索引呢，还是非唯一索引，或者说没有索引。

在可重复读隔离级别下，以上三种情况都是有可能的。

如果是唯一索引，还要看查看的记录是否存在，如果存在，那么这条记录加的锁变成记录锁，其它还是临键锁；如果不存在则加间隙锁。

如果是非唯一索引，也要看记录是否存在，如果存在，由于非唯一索引可能有多个相同的值，所以它会进行一个扫描，对于符合条件的二级索引记录加临键锁，最后扫描到第一个不符合条件的二级索引记录就停止，然后对第一个不符合条件的记录加间隙锁，同时，在其主键索引上加记录锁。如果不存在，对第一个不符合条件的二级索引记录加间隙锁。

如果没有索引或没有命中，那就全表扫描，都加临键锁。
